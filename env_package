#!/bin/bash
nfc="gpio"
# creation .env.js
echo "----- Création .env.js"
echo "export const env = {" > ./nfcServer/.env.js
if [ $nfc = 'gpio' ]
then
  # gpio
  echo '  '\"device\": \"vma405-rfid-rc522\",  >> ./nfcServer/.env.js
else
  # usb
  echo '  '\"device\": \"acr122u-u9\",  >> ./nfcServer/.env.js
fi

echo '  '\"server_pin_code\": \"https://discovery.filaos.re\",  >> ./nfcServer/.env.js
echo '  '\"hostname\": \"$(hostname)\", >> ./nfcServer/.env.js
echo '  '\"front_type\": \"FOR\", >> ./nfcServer/.env.js
echo '  '\"mode_nfc\": \"NFCLO\", >> ./nfcServer/.env.js
echo '  '\"current_server\": \"\", >> ./nfcServer/.env.js
echo '  '\"servers\": [], >> ./nfcServer/.env.js
echo '  '\"exeChromium\": \"chromium-browser\", >> ./nfcServer/.env.js
echo '  '\"dev\": true >> ./nfcServer/.env.js
echo "}" >> ./nfcServer/.env.js

# creation package.json
echo "----- Création package.json"
JSON_STRING='{
"name":"client-raspberry-cashless-laboutik",
"version":"1.0.0",
"description":"serveur nfc",
"main":"serveur_nfc.js",
"type":"module",
"license": "ISC",
"dependencies":{
  "ip": "^1.1.8","socket.io": "^4.7.2",
  "@sentry/node": "^7.106.0","@sentry/profiling-node": "^7.106.0",
  "slugify": "^1.6.6",
  "http-proxy": "^1.18.1",'

if [ $nfc = 'gpio' ]
  then
    # gpio
    JSON_STRING2='"rpi-softspi": "^1.0.5", "rpio": "^2.4.2"}}'
  else
    # usb
    JSON_STRING2='"nfc-pcsc": "^0.8.1"}}'
  fi

echo "${JSON_STRING}" > ./nfcServer/package.json
echo "${JSON_STRING2}" >> ./nfcServer/package.json
