#!/bin/bash
nfc="gpio"
server_pin_code="https://discovery.filaos.re"
nfc_server_port=3000
nfc_server_address="localhost"
nfc_server_version="2.24.04.11.15.58"
front_type="FPI"

# creation .env.js
echo "----- Création .env.js"
echo "export const env = {" > ./nfcServer/.env.js
echo '  '\"mode_nfc\": \"NFCLO\", >> ./nfcServer/.env.js
echo '  '\"front_type\": \"$front_type\", >> ./nfcServer/.env.js
echo '  '\"server_pin_code\": \"$server_pin_code\",  >> ./nfcServer/.env.js
echo '  '\"servers\": [], >> ./nfcServer/.env.js
echo '  '\"client\": null, >> ./nfcServer/.env.js
echo '  '\"current_server\": \"\", >> ./nfcServer/.env.js
echo '  '\"nfc_server_port\": $nfc_server_port, >> ./nfcServer/.env.js
echo '  '\"nfc_server_address\": \"$nfc_server_address\", >> ./nfcServer/.env.js
echo '  '\"exeChromium\": \"chromium-browser\", >> ./nfcServer/.env.js
echo '  '\"dev\": false, >> ./nfcServer/.env.js
echo '  '\"version\": \"$nfc_server_version\", >> ./nfcServer/.env.js
echo '  '\"logLevel\": 1, >> ./nfcServer/.env.js
if [ $nfc = 'gpio' ]
then
  # gpio
  echo '  '\"device\": \"vma405-rfid-rc522\"  >> ./nfcServer/.env.js
else
  # usb
  echo '  '\"device\": \"acr122u-u9\"  >> ./nfcServer/.env.js
fi
echo "}" >> ./nfcServer/.env.js

# creation package.json
echo "----- Création package.json"
JSON_STRING='{
"name":"client-raspberry-cashless-laboutik",
"version":"1.0.0",
"description":"serveur nfc",
"main":"serveur_nfc.js",
"type":"module",
"license": "ISC",
"dependencies":{
  "ip": "^1.1.8","socket.io": "^4.7.2",
  "@sentry/node": "^7.106.0","@sentry/profiling-node": "^7.106.0",
  "slugify": "^1.6.6",
  "http-proxy": "^1.18.1",'

if [ $nfc = 'gpio' ]
  then
    # gpio
    JSON_STRING2='"rpi-softspi": "^1.0.5", "rpio": "^2.4.2"}}'
  else
    # usb
    JSON_STRING2='"nfc-pcsc": "^0.8.1"}}'
  fi

echo "${JSON_STRING}" > ./nfcServer/package.json
echo "${JSON_STRING2}" >> ./nfcServer/package.json
